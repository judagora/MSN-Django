{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motors Safety Net - Cambiar Contraseña</title>
    <link rel="stylesheet" href="{% static 'found/css/InsertarP.css' %}">
    <link rel="stylesheet" href="{% static 'found/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'found/css/Colores.css' %}">
    <link rel="stylesheet" href="{% static 'found/css/styles.css' %}">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.2/css/dataTables.dataTables.css">
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <link rel="shortcut icon" href="{% static 'found/img/logo-msn.svg' %}" type="image/x-icon">
</head>

<body class="fuente">

    <!-- Barra de Navegación -->
    <header>

        <div class="logo">
            <a class="link" href="{% url 'inicio:index' %}">
                <img src="{% static 'iniciosource/img/logo-msn.svg'%}" alt="">
                <h1>Motors Safety Net</h1>
            </a>

        </div>

        <nav class="barraNav">
            <ul>
                <li><a class="link" href="{% url 'index'%}">Inicio</a></li>
                <li><a class="link" href="#">Acerca de Nosortos</a></li>
                <li><a class="link" href="#">Contactanos</a></li>
                <li><a class="link" href="#servicios">Servicios</a></li>
            </ul>


        </nav>
    </header>

    <!-- Contenido de la página -->
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <h1 class="text-center">Cambiar Contraseña</h1>
                <br>
                <!-- Mostrar mensajes de error o éxito -->
                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Formulario de cambio de contraseña -->
                <form method="post" onsubmit="return validarFormulario()">
                    {% csrf_token %}

                    <!-- Campo: Correo Electrónico -->
                    <div class="mb-3">
                        <label for="correo_electronico" class="form-label">Correo Electrónico</label>
                        <input type="email" name="correo_electronico" class="form-control" id="correo_electronico"
                            required>
                        <label id="errorCorreo" class="text-danger" style="display: none;"></label>
                    </div>

                    <!-- Campo: Nueva Contraseña -->
                    <div class="mb-3">
                        <label for="nueva_contraseña" class="form-label">Nueva Contraseña</label>
                        <input type="password" name="nueva_contraseña" class="form-control" id="nueva_contraseña"
                            required>
                        <label id="errorNuevaContraseña" class="text-danger" style="display: none;"></label>
                    </div>

                    <!-- Campo: Confirmar Contraseña -->
                    <div class="mb-3">
                        <label for="confirmar_contraseña" class="form-label">Confirmar Contraseña</label>
                        <input type="password" name="confirmar_contraseña" class="form-control"
                            id="confirmar_contraseña" required>
                        <label id="errorConfirmarContraseña" class="text-danger" style="display: none;"></label>
                    </div>

                    <!-- Botón de envío -->
                    <div class="row mt-3">
                        <div class="col-5">
                            <button class="btn w-100" type="submit"
                                style="background-color: #128C7E; border-color: #128C7E; color: white; margin-left: 80%;">
                                Cambiar Contraseña
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script>
        function validarFormulario() {
            let correo = document.getElementById("correo_electronico").value;
            let nuevaContraseña = document.getElementById("nueva_contraseña").value;
            let confirmarContraseña = document.getElementById("confirmar_contraseña").value;

            // Obtener etiquetas de error
            let errorCorreo = document.getElementById("errorCorreo");
            let errorNuevaContraseña = document.getElementById("errorNuevaContraseña");
            let errorConfirmarContraseña = document.getElementById("errorConfirmarContraseña");

            // Limpiar mensajes de error anteriores
            errorCorreo.style.display = "none";
            errorNuevaContraseña.style.display = "none";
            errorConfirmarContraseña.style.display = "none";

            // Validar correo electrónico
            let correoRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!correoRegex.test(correo)) {
                errorCorreo.innerText = "Ingrese un correo electrónico válido.";
                errorCorreo.style.display = "block";
                return false; // Evita que el formulario se envíe
            }

            // Validar nueva contraseña
            if (nuevaContraseña.length < 8) {
                errorNuevaContraseña.innerText = "La contraseña debe tener al menos 8 caracteres.";
                errorNuevaContraseña.style.display = "block";
                return false; // Evita que el formulario se envíe
            }

            // Validar que las contraseñas coincidan
            if (nuevaContraseña !== confirmarContraseña) {
                errorConfirmarContraseña.innerText = "Las contraseñas no coinciden.";
                errorConfirmarContraseña.style.display = "block";
                return false; // Evita que el formulario se envíe
            }

            return true; // Si todo está correcto, permite que el formulario se envíe
        }
    </script>
</body>

</html>